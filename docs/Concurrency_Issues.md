# 발생 가능한 동시성 문제 및 해결책

## 1️⃣ 포인트 관련 동시성 문제

| 문제 유형                      | 발생 상황                              | 해결책                                                            |
|----------------------------|------------------------------------|----------------------------------------------------------------|
| **Dirty Read (더티 리드)**     | 커밋되지 않은 데이터를 다른 트랜잭션이 조회           | READ COMMITTED 이상 트랜잭션 격리 수준 사용                                |
| **Lost Update (손실된 업데이트)** | 동시 업데이트 시 한 트랜잭션의 변경 사항이 덮어씌워짐     | 비관적 락(SELECT ... FOR UPDATE) 또는 낙관적 락(@Version) 적용             |
| **Race Condition (경쟁 상태)** | 여러 트랜잭션이 동시에 포인트를 사용하여 잔액보다 많이 차감됨 | Atomic 연산(UPDATE ... WHERE balance >= amount) 또는 Redis 분산 락 활용 |
| **Deadlock (교착 상태)**       | 트랜잭션 간 서로 락을 대기하여 무한 대기 상태 발생      | 트랜잭션 실행 순서 일관되게 유지 및 Lock Timeout 설정                           |

---

## 2️⃣ 제품 조회 및 인기 상품 조회 관련 동시성 문제

| 문제 유형                    | 발생 상황                             | 해결책                                           |
|--------------------------|-----------------------------------|-----------------------------------------------|
| **Phantom Read (팬텀 리드)** | 인기 상품 조회 시 데이터 변경으로 인해 조회 결과가 달라짐 | REPEATABLE READ 또는 SERIALIZABLE 트랜잭션 격리 수준 사용 |

---

## 3️⃣ 주문 및 결제 관련 동시성 문제

| 문제 유형                                 | 발생 상황                                 | 해결책                                                                                                                            |
|---------------------------------------|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| **Lost Update (손실된 업데이트) - 이중 지불 문제** | 하나의 주문을 두 번 결제하는 문제 발생                | 비관적 락(SELECT ... FOR UPDATE), 낙관적 락(@Version), Atomic 연산(UPDATE ... WHERE status = 'PENDING'), UNIQUE CONSTRAINT (order_id) 추가 |
| **Race Condition (경쟁 상태) - 이중 지불 문제** | 여러 결제 요청이 동시에 발생하여 동일한 주문이 중복 결제될 가능성 | Redis 분산 락 활용하여 결제 요청을 하나씩 처리                                                                                                  |
| **Deadlock (교착 상태)**                  | 주문과 포인트 차감이 동시에 이루어질 때 교착 상태 발생       | 트랜잭션 실행 순서 일관되게 유지 및 Lock Timeout 설정                                                                                           |

---

## 4️⃣ 선착순 쿠폰 발급 관련 동시성 문제

| 문제 유형                      | 발생 상황                                      | 해결책                                                    |
|----------------------------|--------------------------------------------|--------------------------------------------------------|
| **Race Condition (경쟁 상태)** | 동시에 많은 사용자가 쿠폰을 신청하여 초과 발급 가능              | Atomic 연산 (UPDATE ... WHERE stock > 0) 및 Redis 분산 락 활용 |
| **Lost Update (손실된 업데이트)** | 여러 사용자가 동시에 쿠폰 요청 시 업데이트 충돌로 인해 잘못된 데이터 반영 | 낙관적 락(@Version) 또는 SERIALIZABLE 격리 수준 설정               |